option_settings:
  aws:elasticbeanstalk:environment:proxy:nginx:
    ProxyServer: nginx
  aws:elasticbeanstalk:container:python:
    WSGIPath: application:app  # Path to the Flask app object

packages:
  yum:
    git: []  # If your project uses git, install it
    gcc: []  # Installing gcc for compiling some packages

container_commands:
  01_migrate:
    command: "python3 manage.py migrate"  # If you have migrations in your project

files:
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      client_max_body_size 10M;  # Customize NGINX settings for request body limits (optional)

# Set up Python version and install dependencies
commands:
  01_pip_install:
    command: "pip install -r requirements.txt"  # Ensure all dependencies in your requirements.txt are installed

  02_python_version:
    command: "alternatives --set python /usr/bin/python3.8"  # Specify Python version (optional)

  03_collect_static:
    command: "python3 manage.py collectstatic --noinput"  # For collecting static files if you have them
    leader_only: true  # Only run this on the leader instance (for multi-instance environments)

# Configure log streaming (optional)
option_settings:
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 14